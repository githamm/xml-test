<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex,nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="shortcut icon" href="https://extras.mnginteractive.com/live/media/favIcon/dpo/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.14/c3.css" />
    <link rel="stylesheet" type="text/css" href="https://extras.denverpost.com/libraries/datatables/DataTables-1.10.16/css/dataTables.foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://extras.denverpost.com/libraries/datatables/Responsive-2.2.1/css/responsive.foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="../styles.css" />
    <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" /> -->
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.js"></script>
    <script src="https://extras.denverpost.com/foundation/js/vendor/modernizr.js"></script>
    <script src="https://extras.denverpost.com/app/homicide-report/js/d3.v3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.14/c3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.11/jquery.csv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://extras.denverpost.com/libraries/datatables/jQuery-3.2.1/jquery-3.2.1.min.js"></script>
    <script src="https://extras.denverpost.com/libraries/datatables/DataTables-1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://extras.denverpost.com/libraries/datatables/DataTables-1.10.16/js/dataTables.foundation.min.js"></script>
    <script src="https://extras.denverpost.com/libraries/datatables/Responsive-2.2.1/js/dataTables.responsive.min.js"></script>
    <script src="https://extras.denverpost.com/libraries/datatables/Responsive-2.2.1/js/responsive.foundation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/yadcf/0.9.2/jquery.dataTables.yadcf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.24/sorting/datetime-moment.js"></script>
    <script src="https://kit.fontawesome.com/206988eca2.js" crossorigin="anonymous"></script>
</head>

<body>
    <script>
    // Loads data files into Papa Parse
    urls = ['election_results_2021.csv']
    Promise.all( //pass array of promises to Promise.all
            urls //you have an array of urls
            .map( //map urls to promises created with parse
                url =>
                new Promise( //create one promise
                    (resolve, reject) =>
                    Papa.parse(
                        url, {
                            download: true,
                            header: true,
                            complete: resolve, //resolve the promise when complete
                            error: reject //reject the promise if there is an error
                        }
                    )
                )
            )
        )
        .then(
            function(electionResults) {
                let rawElectionResults = electionResults[0].data;
                console.log(rawElectionResults)

                var raceNameList = [];
                for (i = 0; i < rawElectionResults.length; i++) {
                    var thingtoAdd = {};
                    thingtoAdd = rawElectionResults[i]['contest name']
                    raceNameList.push(thingtoAdd);
                }
                var unique = raceNameList.filter(function(elem, index, self) {
                    return index === self.indexOf(elem);
                })
                console.log(unique)

                let map = new Map()
                rawElectionResults.forEach((currentValue) => {
                    map.has(currentValue['contest name']) ?
                        map.get(currentValue['contest name']).push({ raceName: currentValue['contest name'], choiceName: currentValue['choice name'], choiceVotes: currentValue['total votes'], choicePct: currentValue['percent of votes'], totalBallotsCast: currentValue['ballots cast'] }) :
                        map.set(currentValue['contest name'], [{ raceName: currentValue['contest name'], choiceName: currentValue['choice name'], choiceVotes: currentValue['total votes'], choicePct: currentValue['percent of votes'], totalBallotsCast: currentValue['ballots cast'] }])
                });
                console.log(map);


            } // end results
        )
        .catch( //log the error
            err => console.warn("Something went wrong:", err)
        )
    </script>
</body>

</html>